---
description: Documentation updates, directory cleanup, configuration changes, and ensuring all files and docs are in their correct locations and up to date.
globs: 
alwaysApply: false
---
---
description: MANDATORY requirement if the agent is looking to create, edit or refactor any code.
globs: 
alwaysApply: false
---
# Recent Lessons Learned & Continuous Improvement

- **Automated Checks & Programmatic Execution:** Always use automated scripts and programmatic tools for directory hygiene, documentation completeness, and configuration management before any manual intervention.
- **TDD & Sandbox-First Workflow:** All new features and bug fixes must be developed using TDD and validated in a sandbox before production.
- **Comprehensive Logging & Documentation:** Log all documentation changes, protocol deviations, and directory hygiene actions in canonical logs for audit and continuous improvement. Update all relevant documentation and protocols after each incident or improvement.
- **Backup/Restore Automation:** Maintain regular, automated backups of all critical files, configurations, and documentation. Use restoration scripts for recovery.
- **Automation Script Review:** Regularly review and refine automation scripts for all workflows (build, test, task, code quality, documentation, tooling, governance).
- **Directory Hygiene:** Enforce strict directory cleanliness and backup rotation to prevent stray files and ensure recoverability.
- **Granular Task Breakdown & Status Automation:** Always break down high-level tasks to granular, testable sub-tasks before implementation. Use automated tools to update task status and trigger workflow automation.
- **Comprehensive Test Coverage & Code Review:** Ensure high coverage for all critical modules and perform rigorous code reviews for all changes, focusing on clarity, maintainability, and adherence to standards.
- **Regular Rule Review & Improvement:** Schedule and enforce periodic reviews of all rule files and automation scripts to ensure relevance, clarity, and effectiveness.

## (CRITICAL AND MANDATORY) Pre-Refactoring and Coding Protocol

**BEFORE REFACTORING OR CODING ANY FILES, ENSURE YOU:**
1. Pause, think, analyse, plan – use `sequential-thinking`, `memory`, and `puppeteer` MCP servers to structure your thoughts, draw on memory, and perform web analysis as needed.
2. Ensure there is a task created, and `taskmaster-ai` MCP has effectively broken down the task to level 5-6 and also provided suitable information about the task.
3. Use `sequential-thinking` MCP Server and do a quick web search to get as much information about similar applications, rival apps, etc, and get as much information from the `BLUEPRINT.md`.
4. Review 'ExampleCode/' folder and understand the context of how to best write Swift Code, using examples. Use `sequential-thinking` and `context7` MCP to research and plan the design based on example. Use `memory` MCP to store this knowledge.
5. Under the Sandbox/Testing Environment: Write the following tests: failing, unit, integration, end-to-end, automation, performance, security, acceptance.
6. Test and adjust testing until all of these tests are passing.
7. Then write the code for the view and ensure it is the best written piece of code you can make it and fulfills the user's requirements.
8. Check Both Sandbox and Production Tests and ensure that any failures are documented and you go back to Step 5.
9. Completed Cycle – attempt to finish in 1 cycle.

Reference: See .cursorrules for enforcement.

# 08. Documentation, Directory & Configuration Management

## 1. Key Document Interaction & Management

*   **(CRITICAL AND MANDATORY) Document Interaction Summary Adherence:** All interactions with key project documents **MUST** follow the `primary_interaction`, `update_frequency`, `reference_frequency`, `update_actions`, and `reference_purpose` as defined in the structured JSON guide within the "Consolidated Project Development Rules (v1.0)" (Section: "Document Interaction Summary (Structured)") or its successor section in `@10_Project_Rules_Governance_And_Evolution.mdc`.
*   **(CRITICAL AND MANDATORY) Document Locations & Naming:**
    *   All key project document filenames **MUST** use uppercase for the base name (e.g., `TASKS.MD`, `BLUEPRINT.MD`).
    *   Standard documents **MUST** reside in their designated locations (primarily `docs/`) as per the mandated repository structure (see Section 2).
*   **(CRITICAL AND MANDATORY) Meticulous Documentation (Automated & Verbose):**
    *   Log ALL steps, analysis, decisions, tool calls, and results verbosely in `@DEVELOPMENT_LOG.MD` (typically via `filesystem` MCP `Edit` append).
    *   Document failures/resolutions comprehensively in `@BUILD_FAILURES.MD` (typically via `filesystem` MCP `Edit`). See `@05_Build_Failure_Resolution_And_Prevention_Framework.mdc`.
    *   Update `@TASKS.MD` (or the project's task management system) constantly with detailed task information, status changes, and implementation notes. See `@03_Task_Management_And_Workflow_Automation.mdc`.
    *   Update `@AI_MODEL_STM.MD` and `@TASK_<ID>_EXECUTION_LOG.MD` as per `@01_Core_AI_Agent_Principles.mdc`.
*   **(CRITICAL AND MANDATORY) No Duplicates & Cleanup:**
    *   Regularly scan for and propose the cleanup or integration of duplicate or redundant documentation.
    *   Core project documents (e.g., `@BLUEPRINT.MD`, `@TASKS.MD`) **MUST NOT** be duplicated. Point to the canonical version.

## 2. Mandated Repository Structure & Directory Cleanliness

*This section consolidates rules from `consolidated_project_rules` (v3.8) and `build_stability_and_task_protocol.mdc`.*

*   **(CRITICAL AND MANDATORY) Strict Adherence to Mandated Structure:** The project **MUST** strictly adhere to the repository structure defined in the relevant section in .cursorrules for repository structure or its successor definition in this document if updated. The AI Agent **MUST** programmatically enforce these standards using the `filesystem` MCP server AT ALL TIMES.
    *   **Key Structure Elements (Summary - Refer to full definition for details):**
        *   `{repo_ProjectNamePlaceholder}/`: Root folder - **NO STRAY AGENT FILES HERE.**
        *   `.gitignore`, `.cursorrules`, `.env` (ignored), `.env.example`, `LICENSE`, `CLAUDE.md` (if applicable).
        *   `claude/`: For Anthropic Claude code recommendations.
        *   `docs/`: **ALL** project documentation (Markdown files like `BLUEPRINT.MD`, `TASKS.MD`, `ARCHITECTURE.MD`, `BUILD_FAILURES.MD`, `XCODE_BUILD_GUIDE.MD`, `XCODE_STYLE_GUIDE.md`, etc.).
        *   `docs/TestData/`: All relevant test data.
        *   `scripts/`: General utility, build, fix scripts.
        *   `shared/`: Code shared across platforms/modules.
        *   `_{PlatformDir}/` (e.g., `_macOS/`, `_iOS/`): Platform-specific root.
            *   Contains `{ProjectFileNamePlaceholder}.xcodeproj` (SweetPad buildable).
            *   `{PlatformSourceRoot}/`: Platform source code (App, Models, Views, ViewModels, Services, Resources, Assets.xcassets).
            *   `Tests/`: Platform tests (Unit, UI).
            *   `build/` (ignored), `logs/` (ignored), `scripts/` (platform-specific).
        *   `temp/`: Temporary files (ignored). Includes `temp/backup/` and `temp/review_placement/`.
        *   `logs/`: General project logs (ignored).
        *   `SwiftLint.yml` (or path defined in `@CODE_QUALITY.MD`).
*   **(CRITICAL AND MANDATORY) Directory & File Cleanliness Enforcement (Housekeeping):**
    *   **Production Xcode Project/Workspace:** Only ONE canonical set in the platform directory (e.g., `_macOS/`). All others **MUST** be deleted or moved to `temp/backup/`.
    *   **Sandbox Projects:** All sandboxed builds/projects **MUST** be under `_{PlatformDir}/sandbox/`. Never mix with production. Batch delete any old/random sandbox projects not in this folder.
    *   **Backups:** Store ONLY in `temp/backup/`. Maximum 3 backups; rotate oldest out. Use batch deletion. Never keep backups in root or platform directories.
    *   **Temp/Review:** Use `temp/review_placement/` for ambiguous files pending review. Do not delete unless confirmed obsolete by user.
    *   **No Stray Files/Folders in Root:** The project root **MUST** remain clean. No logs, build artifacts, or random files/folders. Enforce batch deletion of any found.
    *   **Logs/Build Artifacts:** All logs and build artifacts **MUST** be in their respective `logs/` and `build/` subdirectories and be included in `.gitignore`.
    *   **Scripts:** All scripts in `scripts/` or platform-specific `_{PlatformDir}/scripts/`. Cataloged in `@SCRIPTS.MD`.
    *   **Strict Enforcement:** Directory hygiene is CRITICAL & MANDATORY for build/test/commit. Programmatic checks, batch deletion, and backup rotation are required for compliance. This is a part of AUTO ITERATE Mode steps (see `@03_Task_Management_And_Workflow_Automation.mdc`).
    *   **Conflicted Files:** Identify and immediately delete any files containing "Conflicted Copy" (or similar conflict markers from synchronization tools). Utilize bulk operations for removal.

## 3. Version Control (Git) Protocol

*   **(CRITICAL AND MANDATORY) Branching Strategy:**
    *   NEVER commit directly to `main`/`master` except for fully completed, tested, and milestone-aligned L3 features (or equivalent major features).
    *   Level 4-6 tasks (sub-tasks) **MUST** be developed on their own dedicated feature/fix branches, branching from their parent task's branch or the main development branch (e.g., `develop`).
    *   Feature branches for L3 tasks (or equivalent) are merged to the main development branch (e.g., `develop`) only after all sub-tasks are complete, all tests pass, and the build is stable and verified.
    *   `develop` is periodically merged to `main`/`master` for releases.
*   **(CRITICAL AND MANDATORY) Commit Messages:**
    *   Write clear, concise, and informative commit messages.
    *   Follow conventional commit formats if specified by the project (e.g., `feat: Implement user login screen (closes #123)`).
    *   Reference relevant task IDs from `@TASKS.MD`.
*   **(CRITICAL AND MANDATORY) Commit Frequency & Checkpoints:**
    *   After every successful build and significant, stable state (e.g., completion of a sub-task), commit changes to the version control system.
    *   Regularly push local branches to the remote repository to back up work and facilitate collaboration.
*   **(CRITICAL AND MANDATORY) GitHub Backup & Sync (via MCP or Bash):**
    *   After every successful production build (all tests pass), or after significant documentation updates, the AI Agent **MUST** use GitHub MCP (if available) or `Bash` Git commands to commit and push changes.
    *   The commit message **MUST** reflect the successfully tested changes, features added, or documentation updates, referencing build/test status and current version number.
    *   Update project documentation (e.g., `@DEVELOPMENT_LOG.MD`, `@BUILD_FAILURES.MD`) with every major change, restoration, or fix *before* committing.
*   **(CRITICAL AND MANDATORY) Version Number Management:**
    *   Consistently update the application's version number in designated project configuration files (e.g., `Info.plist`, build scripts, `@BLUEPRINT.MD`) following significant changes or releases.
    *   Ensure this updated version number is accurately reflected and prominently displayed where necessary (e.g., within `MainContentView.swift` or an equivalent About/Info section of the app).

## 4. Configuration Management

*   **(CRITICAL AND MANDATORY) No Hardcoding of Configurable Values:**
    *   Configuration values (e.g., API endpoints, feature flags, timeouts, external service URLs) **MUST NOT** be hardcoded directly in source code.
*   **(CRITICAL AND MANDATORY) External Configuration Files:**
    *   Store configurable values in external configuration files (e.g., `.env` files, `.xcconfig` for Xcode, JSON, YAML) as specified by `@ARCHITECTURE_GUIDE.MD`.
    *   Provide sensible, non-sensitive default values if appropriate, often in an example configuration file (e.g., `.env.example`).
*   **(CRITICAL AND MANDATORY) Secure Secret Management:**
    *   Sensitive configuration values (API keys, passwords, private certificates) **MUST NOT** be committed to version control.
    *   Such files (e.g., `.env` containing actual secrets) **MUST** be listed in `.gitignore`.
    *   Employ environment variables, vault solutions (like HashiCorp Vault), or platform-specific secure storage mechanisms (like macOS/iOS Keychain) as defined in `@SECURITY_GUIDELINES.MD` and specified by the `{SecurityMethod}` in `@BLUEPRINT.MD`.
*   **(CRITICAL AND MANDATORY) Runtime Loading:** Implement code to load configuration values at runtime from these external sources.
*   **(CRITICAL AND MANDATORY) Documentation in `@README.MD`:** Document all required environment variables and configuration settings necessary to run the project in `@README.MD`.

## 5. Dependency Management

*   **(CRITICAL AND MANDATORY) Manifest Files:**
    *   All external project dependencies (libraries, frameworks) **MUST** be managed through a standard manifest file appropriate for the platform/language (e.g., `Package.swift` for Swift Package Manager, `Podfile` for CocoaPods, `build.gradle`/`pom.xml` for Java/Kotlin, `package.json` for Node.js, `requirements.txt`/`Pipfile`/`pyproject.toml` for Python).
    *   This manifest file **MUST** be committed to version control.
*   **(CRITICAL AND MANDATORY) Specify Versions Clearly:**
    *   Specify dependency versions precisely (e.g., `1.2.3`) or use narrow, well-defined version ranges (e.g., `~> 1.2.0` meaning >= 1.2.0 and < 1.3.0) to ensure reproducible builds and avoid unexpected breaking changes from transitive dependencies. Avoid open-ended versions (e.g., `*` or `latest`) for production dependencies.
*   **(CRITICAL AND MANDATORY) Regular Review & Updates:**
    *   Periodically review project dependencies for updates, especially security patches.
    *   Before updating a dependency, assess its impact on the project (breaking changes, new features, deprecations) and test thoroughly in a sandboxed environment.
    *   Utilize tools for scanning dependencies for known vulnerabilities (e.g., `npm audit`, `pip-audit`, Snyk, GitHub Dependabot). Address identified vulnerabilities promptly based on severity.
    *   Log significant dependency updates or vulnerability mitigations in `@DEVELOPMENT_LOG.MD`.

## 6. Initial Document Generation Templates (Minimal)

*   **(CRITICAL AND MANDATORY) Programmatic Generation:** During "Initialise Mode" (see `@02_Project_Lifecycle_And_Methodology.mdc`), if core documents are missing, they **MUST** be proposed for creation using the following minimal templates. Proposed filenames **MUST** use uppercase base names.

*   **`@docs/TASKS.MD` Template:**
    ```markdown
    # Tasks

    | ID | Task/Subtask Name | Status      | Priority | Dependencies | Comments/Notes |
    |----|-------------------|-------------|----------|--------------|----------------|
    | 1  | Initial Setup     | pending     | P0       |              | Basic project scaffolding |
    ```

*   **`@docs/BUGS.MD` Template:**
    ```markdown
    # Bugs Log

    | ID | Bug Description | Status      | Priority | Assigned To | Reported Date | Resolved Date | Resolution Notes |
    |----|-----------------|-------------|----------|-------------|---------------|---------------|------------------|
    | B001| Example Bug Entry| Open        | High     |             | YYYY-MM-DD    |               |                  |
    ```

*   **`@docs/DEVELOPMENT_LOG.MD` Template:**
    ```markdown
    # Development Log

    ## YYYY-MM-DD

    *   **Decision/Event:** Project Initialized.
        *   **Rationale:** Starting new project development.
        *   **Outcome:** Core directory structure and initial documents created.
        *   **Participants/Author:** AI Agent
    ```

*   **`@docs/CODING_STANDARDS.MD` Minimal Template:**
    ```markdown
    # Coding Standards

    ## 1. General Principles
    - Code should be clear, readable, and maintainable.
    - Follow the DRY (Don't Repeat Yourself) principle.
    - Follow the KISS (Keep It Simple, Stupid) principle.

    ## 2. Naming Conventions
    - (Specify for variables, functions, classes, etc. e.g., camelCase for functions, PascalCase for classes for Swift/Kotlin/Java; snake_case for Python/Ruby variables & functions, PascalCase for classes)

    ## 3. Formatting
    - (Specify indentation [e.g., 2 spaces, 4 spaces, tabs], line length [e.g., 120 chars], braces style, etc. Or refer to an auto-formatter configuration like .swiftformat, .prettierrc, black)

    ## 4. Comments
    - Comment complex logic, non-obvious decisions, and public APIs.
    - Use language-standard documentation comment syntax (e.g., `///` for SwiftDoc, `/** ... */` for JavaDoc/JSDoc).

    ## 5. Language-Specific Guidelines
    - (Add sections for specific languages used in the project, e.g., Swift, Python, JavaScript)

    ## 6. Error Handling
    - (Specify preferred error handling mechanisms, e.g., exceptions, error codes, Result types)
    ```

*   **`@docs/SECURITY_GUIDELINES.MD` Minimal Template:**
    ```markdown
    # Security Guidelines

    ## 1. Data Handling
    - Classify data (e.g., Public, Internal, Confidential, Secret).
    - Specify encryption requirements for data at rest and in transit for each classification.
    - Rules for handling Personally Identifiable Information (PII) in compliance with relevant regulations (e.g., GDPR, CCPA).

    ## 2. Authentication & Authorization
    - Minimum password complexity rules (length, character types).
    - Multi-Factor Authentication (MFA) requirements for user and admin accounts.
    - Principle of Least Privilege for access control: Grant only necessary permissions.

    ## 3. Input Validation & Output Encoding
    - All external input (user forms, API requests, file uploads) MUST be validated and sanitized on the server-side.
    - Encode output appropriately to prevent XSS (Cross-Site Scripting) and other injection attacks when rendering data in UIs or APIs.

    ## 4. Dependency Management
    - Regularly scan dependencies for known vulnerabilities using automated tools (e.g., Snyk, Dependabot, `npm audit`).
    - Policy for using third-party libraries: Define approved licenses, process for evaluating new dependencies, and criteria for vulnerability status.

    ## 5. Secret Management
    - API keys, database credentials, passwords, and other secrets MUST NOT be hardcoded or committed to version control.
    - Specify approved methods for storing and accessing secrets (e.g., environment variables via `.env` files [ignored by Git], HashiCorp Vault, AWS Secrets Manager, Azure Key Vault, GCP Secret Manager, Kubernetes Secrets, platform Keychain services).

    ## 6. Logging & Monitoring
    - Do not log sensitive information (passwords, API keys, PII) in plain text in application logs.
    - Ensure adequate logging for security event monitoring, audit trails, and incident response.

    ## 7. Secure Development Lifecycle (SDL)
    - (Reference any SDL processes, e.g., threat modeling during design, security code reviews, penetration testing schedule).
    ```

### UX/UI Change Checkpoint Rule (Updated)
- At the first implementation of any new UI code (or any significant UX/UI change), a checkpoint **MUST** be made to capture and save relevant screenshots/images in `docs/UX_Snapshots/`.
- **Naming convention:** `YYYYMMDD_HHMMSS_<TaskID>_<ShortTaskName>.png`
- This folder is mandatory and must be kept organized (e.g., by date, feature, or task ID).
- After saving, a user notification **MUST** be issued (in SMEAC/VALIDATION REQUEST, commit message, or UI alert) specifying the filenames and location.
- Screenshots/images should be referenced in SMEAC/VALIDATION REQUESTS and documentation for traceability and review.

## Cross-Reference: Automated UX/UI Screenshot Navigation & Validation

All documentation and automation for UX/UI screenshots must follow the generic, project-agnostic process described in `docs/SCRIPTS.MD` and `.cursorrules`. This includes:
- Programmatic navigation to the relevant screen/state before capture
- Post-mortem analysis and logging
- Use of the checkpoint and post-mortem templates

### MANDATORY Enforcement of UX/UI Snapshotting & OCR Directory Protocol

- All UI/UX changes must result in new screenshots and OCR logs in `docs/UX_Snapshots/`.
- Directory hygiene checks must verify the presence and correct naming of these files for every UI/UX change.
- If missing, block task completion and escalate via SMEAC/VALIDATION.
- Refer to the canonical protocol in .cursorrules and `behaviours_visual-ai-snapshot.mdc`.

## 3. Key Documentation Reference Table (MANDATORY)

This table defines the canonical documentation files for the project, their purpose, when to update, and when to use them in the workflow. All automation, compliance, and development processes must reference this table for correct document usage.

| Document | Purpose | When to Update | When to Use (Processes/Phases) |
|----------|---------|---------------|-------------------------------|
| **AI_MODEL_STM.md** | Logs AI agent short-term memory (STM) snapshots at major decision points, context loads, and reasoning. | After every major decision, context load, or reasoning step by AI/automation. | During AI/automation, task selection, build/test, error handling, and context acquisition. |
| **ARCHITECTURE_GUIDE.MD** | Outlines architectural decisions, patterns, and guidelines for the project. | When architecture changes, new patterns are adopted, or major refactors occur. | At the start of new features, refactoring, onboarding, and code reviews. |
| **BLUEPRINT.md** | Canonical project specification, configuration, and root definition. | When requirements, configuration, or project root change. | At project initialization, onboarding, automation, and whenever referencing project root or configuration. |
| **BUGS.md** | Tracks all identified bugs, their status, and resolution. | When new bugs are found, resolved, or prevention notes are added. | During bug triage, resolution, and post-mortem analysis. |
| **BUILD_FAILURES.MD** | Logs all build failures, analysis, and resolution methods. | After any build failure or resolution. | During troubleshooting, build/test, and post-mortem. |
| **BUILD_FIXES.md** | Documents specific build issues that have been resolved and preventative measures. | After resolving a build issue or implementing a fix. | During build troubleshooting, after fixes, and for future prevention. |
| **DEVELOPMENT_GUIDE.md** | Comprehensive guide to the development workflow, processes, and best practices. | When workflow, process, or best practices change. | At onboarding, before starting tasks, and during process reviews. |
| **DEVELOPMENT_LOG.MD** | Chronological log of all development activities, decisions, and issues. | After every significant action, decision, or issue. | Throughout development, for traceability and audits. |
| **DEVELOPMENT_TESTING_GUIDE.md** | Outlines the comprehensive testing approach, including UI/UX validation and automated testing. | When testing strategy, tools, or workflow changes. | Before/after implementing tests, during QA, and for onboarding. |
| **QUICK_REF_GUIDE_DEVELOPMENT.md** | Condensed reference of the complete development workflow and checklists. | When workflow or checklists change. | As a quick reference before/during any development phase. |
| **README.md** | Primary entry point to the project, overview, structure, and essential resources. | When project overview, structure, or setup changes. | At onboarding, setup, and for external communication. |
| **SCRIPTS.md** | Overview and usage guide for all scripts and automation tools. | When scripts are added, changed, or removed. | Before running scripts, automation, or troubleshooting. |
| **TASKS.md** | Central hub for tracking all tasks, subtasks, and their status. | When tasks are created, updated, or completed. | During planning, execution, and review of all work. |
| **UI_UX_TESTING_GUIDE.md** | Comprehensive approach to UI/UX testing, screenshot capture, OCR validation, and automation. | When UI/UX testing process or tools change. | Before/after UI/UX changes, during validation, and for onboarding. |
| **VIEW_STATE_UI_BEST_PRACTICES.md** | Best practices for view state management, naming, navigation, and documentation. | When best practices or UI patterns change. | During UI implementation, review, and onboarding. |
| **XCODE_BUILD_CONFIGURATION.MD** | Details Xcode project configuration, structure, and build requirements. | When build settings, structure, or configuration change. | During build setup, troubleshooting, and CI/CD configuration. |
| **XCODE_BUILD_GUIDE.md** | Definitive reference for building, configuring, and maintaining Xcode projects. | When build process, standards, or troubleshooting steps change. | During build, test, troubleshooting, and onboarding. |
| **XCODE_STYLE_GUIDE.md** | Defines the visual design system, UI components, and interaction patterns. | When design system, UI components, or patterns change. | During UI/UX implementation, review, and onboarding. |

**MANDATE:** All contributors (AI or human) must reference this table for correct document usage. All automation and compliance checks must validate against this table. Any changes to document names, locations, or purposes must be reflected here and in all related rules.

## 4. Standard Directory Structure

All projects must follow this canonical directory structure:

```plaintext
{repo_ProjectNamePlaceholder}/ # Root - NO STRAY FILES HERE
+-- .gitignore, .cursorrules, .build, .cursor, .git, .vscode, .env, .env.example
+-- CLAUDE.md, LICENSE
+-- claude/               # Claude Code Recommendations
+-- docs/                 # ALL documentation goes here
|   +-- README.MD, ARCHITECTURE.MD, ARCHITECTURE_GUIDE.MD
|   +-- BLUEPRINT.MD      # SPECIFICATION & CONFIGURATION
|   +-- TASKS.MD          # Workflow hub (L4+ sub-tasks)
|   +-- BUGS.MD, DEVELOPMENT_LOG.MD, BUILD_FAILURES.MD
|   +-- BUILDING.MD, CODE_QUALITY.MD, COMMON_ERRORS.MD
|   +-- XCODE_BUILD_GUIDE.md, XCODE_STYLE_GUIDE.md
|   +-- (Additional documentation)
|   +-- ExampleCode/     # Example Code files and inspiration
|   +-- TestData/        # Test data here
|   +-- UX_Snapshots/    # Screenshots/images of UI/UX changes (MANDATORY)
+-- scripts/             # All utility scripts
+-- shared/              # Cross-platform shared code
+-- _{PlatformDir}/      # Platform code (e.g., _macOS/, _iOS/)
|   +-- {ProjectFileNamePlaceholder}.xcodeproj # MUST BE SWEETPAD BUILDABLE
|   +-- {PlatformSourceRoot}/  # Platform source code
|   +-- {PlatformSourceRootSandbox}/  # Platform Sandbox source code
|   +-- Tests/           # Platform tests
|   +-- build/, logs/    # Build artifacts & logs (gitignored)
|   +-- scripts/         # Platform-specific scripts
+-- {TestDataDirectoryPath}/ # Multiplatform Test data & mocks
+-- temp/                # Temporary files (gitignored)
+-- logs/                # General logs (gitignored)
```

## 5. Key Directory Principles
- **Production Project:** Only ONE canonical set in platform directory.
- **Sandbox:** All sandbox projects in `_{PlatformDir}/sandbox/`
- **Backups:** Only in `temp/backup/`, max 3, rotate oldest out.
- **No Stray Files:** Root must remain clean. Enforce batch deletion.
- **Documentation:** All docs in `docs/` only.
- **Rule Files:** Rule definition files in `.cursor/rules/`
- **Scripts:** In `scripts/` or platform-specific `_{PlatformDir}/scripts/`
- **Logs:** All logs in appropriate `logs/` folders and gitignored.

---
*Effective management of project documentation, directory structure, configurations, and dependencies is crucial for maintainability, collaboration, and reproducibility.*

## CRITICAL AND MANDATORY: Summary & Recommendation Protocol (2024-05-18 Update)

- All user-facing outputs (including SMEAC/VALIDATION REQUEST, checkpoint, and major status updates) MUST include:
  - A **Summary** section at the bottom, immediately before the **Recommendation/Next Steps** section.
  - The **Recommendation** must be clear, actionable, and mandatory.
- **Before writing the Recommendation, the AI agent MUST:**
  1. Use the `sequential-thinking` MCP server to plan the response and next steps.
  2. Use the `context7` MCP to retrieve or cross-reference any additional documentation or context required.
  3. Use the `perplexity` MCP to finalize research and ensure the recommendation is up-to-date and comprehensive.
- The SMEAC/VALIDATION REQUEST template MUST be updated to include these requirements, with the Summary and Recommendation sections at the bottom.

## 8.7. MCP Server/Tool Utilization (CRITICAL AND MANDATORY)
- All documentation, directory, and configuration management processes MUST utilize:
    - `puppeteer` for web analysis
    - `perplexity-ask` for research
    - `momory` for information storage/recall
    - `context7` for latest documentation
    - `sequential-thinking` for planning/analysis
- These are REQUIRED for all documentation review, update, and configuration analysis. Violation triggers P0 STOP EVERYTHING.

## 8.9. (CRITICAL AND MANDATORY) Mock/Fake Data & Integration Prohibition and Enforcement

- Mock/fake data, services, or integrations are permitted ONLY for development, testing, or sandbox environments.
- Every instance MUST be explicitly logged as technical debt in @TASKS.MD and trigger an update to @BLUEPRINT.MD, documenting the current state and plan for real integration.
- It is STRICTLY FORBIDDEN to ship any milestone (Alpha, Beta, Production, App Store, etc.) with features that use mock/fake data, services, or integrations.
- All milestone definitions MUST explicitly prohibit shipping features with mock/fake dependencies.
- Any use of mock/fake data/services/integrations MUST create subtasks for real integration and user validation, tracked to completion before release.
- This rule is compulsory and enforced at every milestone checkpoint and release process. Reference .cursorrules for full enforcement protocol.

## Documentation, Directory, and Configuration Management from .cursorrules

### 1.7. Documentation Standards
* **(CRITICAL AND MANDATORY) Comprehensive Documentation:** All project aspects (architecture, design, features, APIs, configurations, processes, tasks, known issues, decisions, post-mortems, and any dependencies) MUST be meticulously documented in `docs/` using Markdown or as specified.
    * Specific documentation requirements are detailed in the relevant section of .cursorrules.
* **(CRITICAL AND MANDATORY) Single Source of Truth:** All documentation MUST reside in the project's `docs/` directory. No external or personal notes/documentation. (Ref: Relevant sections in .cursorrules)
* **(CRITICAL AND MANDATORY) Living Documentation:** Documentation MUST be continuously updated with code and project changes. Stale documentation is a P1 issue.
* **(CRITICAL AND MANDATORY) Accessibility & Clarity:** Documentation MUST be clear, concise, well-organized, and easily accessible to all team members. Use standardized templates where available (e.g., `docs/templates/`).
* **(CRITICAL AND MANDATORY) Automated Verification:** Where possible, documentation accuracy should be programmatically verified (e.g., API doc generation, config validation against schema).

### 6.1. Documentation Management (MANDATORY PROTOCOLS)

*   **Single Source of Truth (SSOT):** ALL documentation (project plans, architecture, style guides, task details, meeting notes, post-mortems, research, etc.) MUST reside in the `/docs` directory or designated subdirectories (e.g., `docs/meeting-notes/`, `docs/research/`). No exceptions. P0 if violated.
*   **Standardized Formats & Templates:** Use Markdown (`.md`, `.mdc`) for all text documents. Adhere to templates in `docs/templates/` (e.g., `TASK_TEMPLATE.MD`, `POST_MORTEM_TEMPLATE.MD`). P1 if non-compliant.
*   **Version Control:** All documentation MUST be version-controlled via Git, same as code. Commit messages must be clear and reference relevant task IDs. (Ref: Git guidelines in `docs/DEVELOPMENT_GUIDE.MD`).
*   **Living Documentation:** Documentation MUST be updated concurrently with code changes, task updates, or decisions. Stale documentation is P1. Regularly review and update key documents (e.g., `BLUEPRINT.MD`, `ARCHITECTURE_GUIDE.MD`) at least once per Sprint/Milestone.
*   **Accessibility & Discoverability:** Documentation MUST be clearly named, well-organized in `docs/`, and easily searchable (e.g., using `grep` or IDE search). A `README.MD` in `docs/` should provide an overview and links to key documents.
*   **Review & Approval:** Significant documentation changes (e.g., architecture, core processes) MUST undergo a review process similar to code reviews (e.g., via PR comments or a designated reviewer). Log review in `DEVELOPMENT_LOG.MD`.
*   **AI-Assisted Documentation:** Use MCPs (`context7`, `perplexity-ask`, `codebase-search`) to assist in drafting, summarizing, and maintaining documentation. Always verify AI-generated content for accuracy and completeness. (Ref: Relevant section in .cursorrules)
*   **Comprehensive Task Documentation:** Every task in `docs/TASKS.MD` MUST have a corresponding detailed file in `tasks/` (e.g., `tasks/001_initial_setup.md`) or be fully detailed within `TASKS.MD` if simple. These files must include requirements, acceptance criteria, implementation notes, test cases, and known issues.
*   **Security for Sensitive Documentation:** Sensitive information (e.g., pre-production API keys for testing, specific vulnerability details before patching) MUST NOT be stored directly in general documentation. If temporary storage is absolutely necessary for development, it must be in a `.gitignore`'d file, explicitly noted in `DEVELOPMENT_LOG.MD` with a P0 task to remove/secure it before any merge to `main`/`develop`. The standard is to use environment variables or a secure vault solution as per relevant sections in .cursorrules and `BLUEPRINT.MD`.

### 6.2. Directory & Configuration Management

*   **(CRITICAL AND MANDATORY P0) Standardized Project Structure:** Strictly adhere to defined project directory structure (see `docs/PROJECT_STRUCTURE.MD`). Any deviation requires documented approval in `DEVELOPMENT_LOG.MD` and `ARCHITECTURE_GUIDE.MD` update.
*   **(CRITICAL AND MANDATORY P0) Configuration Files in `/config`:** All project-level configuration files (e.g., linters, build tools, environment settings stubs) MUST be stored in a dedicated `/config` directory at project root unless tool-specific absolute paths are required (document exceptions).
*   **(CRITICAL AND MANDATORY P0) Environment-Specific Configurations:**
    *   Use `.env` files (e.g., `.env.development`, `.env.production`, `.env.sandbox`) at project root for environment-specific variables. These files MUST be in `.gitignore`.
    *   A template/example file (e.g., `.env.example`) MUST be committed to `/config` or project root, listing all required variables without actual secrets.
    *   Application loads appropriate `.env` based on current environment context (e.g., `NODE_ENV` variable).
*   **(CRITICAL AND MANDATORY P0) Secrets Management:** Strictly follow relevant sections in .cursorrules. No secrets in version control. Use platform-provided secure storage or `.env` files (ignored by Git).
*   **(CRITICAL AND MANDATORY P0) Configuration Schema & Validation:** For complex configurations, define a schema (e.g., JSON Schema) and validate configurations against it during build or startup. Store schemas in `/config/schemas`.
*   **(CRITICAL AND MANDATORY P0) Centralized Build Scripts:** All primary build, test, and deployment scripts MUST be located in a `/scripts` directory at project root and be executable. Sub-scripts for specific platforms can be in platform folders but linked/called from `/scripts`.
*   **(CRITICAL AND MANDATORY P0) Asset Management:** All static assets (images, fonts, etc.) MUST be organized in a dedicated `/assets` directory, with subdirectories for type/platform (e.g., `assets/_macOS/images`, `assets/common/fonts`).
*   **(CRITICAL AND MANDATORY P0) Derived Data & Build Artifacts:** All generated files, build artifacts, logs (unless specified for `docs/`), and IDE/editor-specific files MUST be added to `.gitignore`. Xcode derived data path must be configured outside the project directory.
*   **Auditability:** Changes to critical configuration files or directory structure MUST be logged in `DEVELOPMENT_LOG.MD` with rationale and task ID.

### 6.3. Development Log & Task Tracking (`DEVELOPMENT_LOG.MD`)

*   **(CRITICAL AND MANDATORY P0) Centralized `DEVELOPMENT_LOG.MD`:** A single, chronological `docs/DEVELOPMENT_LOG.MD` MUST be maintained at the root of the `docs/` directory.
*   **(CRITICAL AND MANDATORY P0) Automated & Manual Entries:**
    *   **Automated:** Key events (builds, tests, deploys, tool runs like `taskmaster-ai`, `XcodeBuildMCP`) MUST be logged automatically by respective tools/scripts with timestamps, status, and relevant IDs.
    *   **Manual:** Significant decisions, issue resolutions, manual interventions, meeting summaries relevant to development progress, configuration changes, and any deviations from standard protocols MUST be manually logged with timestamp, author, task ID (if any), and concise description.
*   **(CRITICAL AND MANDATORY P0) Content Requirements:** Each log entry MUST include:
    1.  Timestamp (YYYY-MM-DD HH:MM:SS UTC).
    2.  Source/Author (Tool name or AI Agent ID/Developer ID).
    3.  Task ID (if applicable, from `docs/TASKS.MD`).
    4.  Event Type (e.g., BUILD, TEST, DECISION, CONFIG_CHANGE, MCP_RUN, POST_MORTEM_LINK).
    5.  Details: Concise summary. For MCP runs, include command and key output/result. For decisions, include rationale. For post-mortems, link to the full document in `docs/post-mortems/`.
*   **(CRITICAL AND MANDATORY P0) Review Frequency:** `DEVELOPMENT_LOG.MD` MUST be reviewed at the start of each work session by the AI agent to maintain context and continuity. It's the primary source for understanding recent project activities.
*   **(CRITICAL AND MANDATORY P0) Immutability (Logical):** Once an entry is logged, it should not be altered, only appended to. Corrections or updates should be new entries referencing the original.
*   **(CRITICAL AND MANDATORY P0) Integration with Task Management:** Log entries should frequently reference Task IDs from `docs/TASKS.MD`. Task updates in `docs/TASKS.MD` should align with log events.
*   **Accessibility:** `DEVELOPMENT_LOG.MD` must be easily parsable by both AI and humans.

### 10. Knowledge Silo Prevention & Cross-Training Protocol

* **(CRITICAL) Documentation as Primary Knowledge Transfer:** Comprehensive, up-to-date documentation (See relevant section in .cursorrules) is the primary mechanism for knowledge sharing and preventing silos. All processes, designs, and decisions MUST be documented.
* **(CRITICAL) Centralized Knowledge Base (`docs/PATTERNS_KB.MD`):** Maintain a living document of common patterns, anti-patterns, solutions to recurring problems, and best practices specific to the project. This MUST be updated after post-mortems, significant discoveries, or new pattern implementations. (Ref: Relevant section in .cursorrules)
* **(CRITICAL) Regular AI Model Rotation & Task Variety (Simulated):** The AI agent should simulate diverse task handling. When starting a new major feature area or after a significant period on one module, the AI should prioritize reviewing documentation and code from *other* areas of the project to maintain broad context.
* **(CRITICAL) "Teach Back" Mechanism (Simulated via `AI_MODEL_STM.MD`):** For complex tasks or new learnings, the AI MUST articulate its understanding, solution approach, and rationale in `docs/AI_MODEL_STM.MD`. This serves as a self-correction and knowledge consolidation step.
* **(CRITICAL) Standardized Tooling & Processes:** Consistent use of defined tools (MCPs, `taskmaster-ai`) and adherence to protocols (e.g., Relevant section in .cursorrules for Swift) ensures that any AI instance or developer can pick up work more easily.
* **(CRITICAL) Cross-Referencing in Documentation:** Actively link between related documents in `docs/` to create a connected web of knowledge (e.g., `BLUEPRINT.MD` links to specific architecture docs, `TASK.MD` entries link to relevant `PATTERNS_KB.MD` solutions).
* **(CRITICAL) Post-Mortem Analysis for Knowledge Gaps:** Build failure post-mortems (relevant section in .cursorrules) MUST include an analysis of whether knowledge gaps contributed and recommend documentation/KB updates.
* **(CRITICAL) Proactive SMEAC/VALIDATION REQUEST for Unfamiliar Areas:** If the AI encounters a task or code area where its confidence (based on `AI_MODEL_STM.MD` self-assessment or lack of recent interaction) is low, it MUST proactively issue a SMEAC/VALIDATION REQUEST for clarification or to confirm its understanding *before* extensive implementation.

### 12. Master Configuration File & Document Management (`docs/BLUEPRINT.MD`)

* **(CRITICAL AND MANDATORY P0) `docs/BLUEPRINT.MD` as Master Config:** This file is the central, human-readable definition of the project's current state, goals, key configurations, and pointers to all other critical documentation and resources. It MUST be the first document consulted for project onboarding or context gathering.
* **(CRITICAL AND MANDATORY P0) Content of `docs/BLUEPRINT.MD` (Minimum):**
    1.  **Project Name & High-Level Goal.**
    2.  **Current Milestone & Objectives.**
    3.  **Key Contacts/Lead Developer(s) (If Applicable).**
    4.  **Core Technologies & Frameworks Used.**
    5.  **Primary Target Platforms & Development Priority (e.g., macOS > iOS).**
    6.  **Pointers to Critical Documentation:** Links to `ARCHITECTURE_GUIDE.MD`, `XCODE_STYLE_GUIDE.MD`, `DEVELOPMENT_GUIDE.MD`, `TESTING_STRATEGY.MD`, `PROJECT_STRUCTURE.MD`, `TASKS.MD`, `DEVELOPMENT_LOG.MD`, `API_REFERENCE.MD`, `PATTERNS_KB.MD`, `UX_UI_GUIDELINES.MD` (or Corporate Style Guide), `SECURITY_PROTOCOLS.MD`.
    7.  **Build & Deployment Configuration Summary:** Key tool versions (Xcode, Swift), bundle identifiers, provisioning profile types (Dev/Dist), primary build scripts.
    8.  **Secrets Management Strategy Used (e.g., `.env` files, Vault path).**
    9.  **Branching Strategy (e.g., GitFlow variant, main branch name).**
    10. **Location of Key Configuration Files (e.g., `/config`, `/scripts`).**
    11. **Current Build Status (link or badge if available, otherwise manual update needed).**
    12. **P0 Stop Everything Rule Reference (relevant section in .cursorrules).**
* **(CRITICAL AND MANDATORY P0) `docs/BLUEPRINT.MD` Maintenance:**
    * MUST be updated IMMEDIATELY upon any change to the items it tracks (e.g., new critical doc, change in branching strategy, milestone completion).
    * Responsibility of the AI agent to ensure its accuracy after any relevant operation.
    * A "Last Reviewed/Updated" timestamp MUST be at the top of `BLUEPRINT.MD`.
    * Verification of `BLUEPRINT.MD` accuracy is a P0 task at the start of any major new development cycle or milestone planning.
* **(CRITICAL AND MANDATORY P0) Document Index (`docs/README.MD`):** A `README.MD` file within the `docs/` directory MUST serve as an index or table of contents for all documents within `docs/`, providing a brief description of each and a link. `BLUEPRINT.MD` is the master *project* definition, while `docs/README.MD` is the master *documentation* index.
* **(CRITICAL AND MANDATORY P0) Automated Checks (Where Feasible):** Scripts should attempt to validate links within `BLUEPRINT.MD` and `docs/README.MD` periodically (e.g., as part of a nightly build or pre-commit hook).

### 13. Environment Management & Configuration

* **(CRITICAL AND MANDATORY P0) Distinct Environments:** Maintain at least three distinct, isolated environments: `development`, `sandbox` (or `staging`), and `production`.
    *   **Development:** Local developer machines. Uses `.env.development`. Highly dynamic.
    *   **Sandbox/Staging:** A stable, production-like environment for final testing, UAT, and demos before production release. Uses `.env.sandbox`. MUST mirror production as closely as possible, including data (anonymized/masked PII). The *ONLY* permissible difference is a visible "Sandbox" watermark/tagline (See relevant section in .cursorrules).
    *   **Production:** The live environment used by end-users. Uses `.env.production`. Highest stability and security requirements.
* **(CRITICAL AND MANDATORY P0) Configuration Parity (Excluding Secrets):** Non-secret configurations (application logic, feature flags if not dynamically managed, UI elements *excluding* Sandbox watermark) MUST be identical between Sandbox and Production. This is a core tenet of the P0 STOP EVERYTHING RULE (relevant section in .cursorrules).
* **(CRITICAL AND MANDATORY P0) Environment Variable Management:**
    *   Environment-specific settings (API endpoints, keys, feature flags, debug levels) MUST be managed via environment variables loaded from `.env` files as per relevant sections in .cursorrules.
    *   Scripts/application logic MUST determine the current environment (e.g., via `NODE_ENV`, `APP_ENV` variable set by the deployment process or launch configuration) and load the corresponding `.env` file (e.g., `.env.production`).
* **(CRITICAL AND MANDATORY P0) Build Process per Environment:**
    *   Build scripts MUST be configurable to target a specific environment.
    *   Production builds MUST be optimized, minified, and stripped of debug symbols/code.
    *   Sandbox builds MUST be near-identical to production builds, with the *only* addition being the Sandbox watermark/tagline.
* **(CRITICAL AND MANDATORY P0) Data Management Across Environments:**
    *   Production data is sacrosanct. Never directly use production data in lower environments if it contains PII.
    *   Sandbox should use anonymized, masked, or realistically generated data that mirrors production data structures and scale.
    *   Development environments may use smaller, specific datasets for targeted testing.
* **(CRITICAL AND MANDATORY P0) Deployment Strategy:**
    *   Deployments MUST first go to Sandbox, pass all tests (automated and manual, including UAT) before being promoted to Production.
    *   Automated deployment scripts are mandatory for Sandbox and Production to ensure consistency and reduce manual error. (Ref: `scripts/deploy_sandbox.sh`, `scripts/deploy_production.sh`)
    *   Rollback strategy and scripts MUST be in place and tested for both Sandbox and Production.
* **(CRITICAL AND MANDATORY P0) Access Control:** Stricter access controls for Sandbox and Production environments compared to Development.
* **(CRITICAL AND MANDATORY P0) Logging & Monitoring:** Configure distinct logging and monitoring for each environment, with more verbose logging typically in Development/Sandbox and focused error/performance monitoring in Production.
* **(CRITICAL AND MANDATORY P0) Documentation:** The configuration and management of each environment MUST be documented in `docs/INFRASTRUCTURE.MD` or a similar dedicated document, referenced by `BLUEPRINT.MD`.

